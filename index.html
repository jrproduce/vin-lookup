<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>VIN Lookup</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { font-size: 24px; }
    h3 { margin-top: 30px; }
    input { padding: 5px; font-size: 16px; }
    button { padding: 5px 10px; font-size: 16px; margin-left: 5px; }
    ul { list-style-type: none; padding-left: 0; }
    li::before { content: "ğŸ”§ "; }
    .section { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ì°¨ëŒ€ë²ˆí˜¸(VIN) ì¡°íšŒ</h1>
  <input type="text" id="vinInput" placeholder="VIN ì…ë ¥í•˜ì„¸ìš”" />
  <button id="lookupBtn">ì¡°íšŒ</button>
  <div id="result"></div>

  <script>
    const apiKey = "AIzaSyBK0R8am8H8bjftzAlkpuM9K5_6NSAftK0";
    const sheetId = "1AZhyeYTwq9AUq5s6ZORisB_7ubWwArXPebTCjGSumaM";
    const sheetName = "JRPARTVIN";

    function getVinParts(vin) {
      fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`)
        .then(res => res.json())
        .then(data => {
          const rows = data.values;
          if (!rows || rows.length < 2) {
            document.getElementById("result").innerHTML = "ğŸ“› ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
            return;
          }

          const headers = rows[0];
          const vinIndex = headers.indexOf("VIN (ì°¨ëŒ€ë²ˆí˜¸)");
          const brandIndex = headers.indexOf("ë¸Œëœë“œ");
          const modelIndex = headers.indexOf("ëª¨ë¸ëª…");
          const yearIndex = headers.indexOf("ì—°ì‹");
          const engineIndex = headers.indexOf("ì—”ì§„í˜•ì‹");
          const fuelIndex = headers.indexOf("ì—°ë£Œ");
          const driveIndex = headers.indexOf("êµ¬ë™ë°©ì‹");
          const colorIndex = headers.indexOf("ì¹¼ë¼ì½”ë“œ");
          const partsIndex = headers.indexOf("í’ˆë²ˆ");
          const nameIndex = headers.indexOf("í’ˆëª…");

          let matchedRows = [];
          let currentVin = "";
          rows.slice(1).forEach(row => {
            if (row[vinIndex]) {
              currentVin = row[vinIndex];
            }
            if (currentVin === vin) {
              matchedRows.push(row);
            }
          });

          if (matchedRows.length === 0) {
            document.getElementById("result").innerHTML = "âŒ VINì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
            return;
          }

          const infoRow = matchedRows[0]; // ì°¨ëŸ‰ ê¸°ë³¸ ì •ë³´ëŠ” ì²« ë²ˆì§¸ í–‰ ê¸°ì¤€
          let html = `<div class="section"><h3>ğŸš— ì°¨ëŸ‰ ê¸°ë³¸ ì •ë³´</h3><ul>`;
          if (infoRow[brandIndex]) html += `<li><strong>ë¸Œëœë“œ:</strong> ${infoRow[brandIndex]}</li>`;
          if (infoRow[modelIndex]) html += `<li><strong>ëª¨ë¸ëª…:</strong> ${infoRow[modelIndex]}</li>`;
          if (infoRow[yearIndex]) html += `<li><strong>ì—°ì‹:</strong> ${infoRow[yearIndex]}</li>`;
          if (infoRow[engineIndex]) html += `<li><strong>ì—”ì§„í˜•ì‹:</strong> ${infoRow[engineIndex]}</li>`;
          if (infoRow[fuelIndex]) html += `<li><strong>ì—°ë£Œ:</strong> ${infoRow[fuelIndex]}</li>`;
          if (infoRow[driveIndex]) html += `<li><strong>êµ¬ë™ë°©ì‹:</strong> ${infoRow[driveIndex]}</li>`;
          if (infoRow[colorIndex]) html += `<li><strong>ì¹¼ë¼ì½”ë“œ:</strong> ${infoRow[colorIndex]}</li>`;
          html += `</ul></div>`;

          html += `<div class="section"><h3>ğŸ“¦ ì†Œëª¨í’ˆ í’ˆë²ˆ ì •ë³´</h3><ul>`;
          matchedRows.forEach(row => {
            if (row[partsIndex]) {
              const partNum = row[partsIndex] || "";
              const partName = row[nameIndex] || "";
              html += `<li><strong>${partNum}</strong> - ${partName}</li>`;
            }
          });
          html += "</ul></div>";

          document.getElementById("result").innerHTML = html;
        })
        .catch(err => {
          document.getElementById("result").innerHTML = "ğŸš« êµ¬ê¸€ì‹œíŠ¸ ì—°ë™ ì˜¤ë¥˜";
        });
    }

    document.getElementById("lookupBtn").addEventListener("click", function () {
      const vin = document.getElementById("vinInput").value.trim();
      if (vin === "") {
        document.getElementById("result").innerHTML = "â— VINì„ ì…ë ¥í•˜ì„¸ìš”.";
        return;
      }
      getVinParts(vin);
    });
  </script>
</body>
</html>
